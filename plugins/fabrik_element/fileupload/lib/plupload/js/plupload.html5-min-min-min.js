/*! Fabrik */
!function(a,b,c,d){function e(b,c){var d;return"FileReader"in a?(d=new FileReader,d.readAsDataURL(b),void(d.onload=function(){c(d.result)})):c(b.getAsDataURL())}function f(b,c){var d;return"FileReader"in a?(d=new FileReader,d.readAsBinaryString(b),void(d.onload=function(){c(d.result)})):c(b.getAsBinary())}function g(a,c,d,f){var g,h,i,l,n=this;e(m[a.id],function(e){g=b.createElement("canvas"),g.style.display="none",b.body.appendChild(g),h=g.getContext("2d"),i=new Image,i.onerror=i.onabort=function(){f({success:!1})},i.onload=function(){var b,m,o,p;if(c.width||(c.width=i.width),c.height||(c.height=i.height),l=Math.min(c.width/i.width,c.height/i.height),1>l||1===l&&"image/jpeg"===d){if(b=Math.round(i.width*l),m=Math.round(i.height*l),g.width=b,g.height=m,h.drawImage(i,0,0,b,m),"image/jpeg"===d){if(o=new j(atob(e.substring(e.indexOf("base64,")+7))),o.headers&&o.headers.length&&(p=new k,p.init(o.get("exif")[0])&&(p.setExif("PixelXDimension",b),p.setExif("PixelYDimension",m),o.set("exif",p.getBinary()),n.hasEventListener("ExifData")&&n.trigger("ExifData",a,p.EXIF()),n.hasEventListener("GpsData")&&n.trigger("GpsData",a,p.GPS()))),c.quality)try{e=g.toDataURL(d,c.quality/100)}catch(q){e=g.toDataURL(d)}}else e=g.toDataURL(d);e=e.substring(e.indexOf("base64,")+7),e=atob(e),o&&o.headers&&o.headers.length&&(e=o.restore(e),o.purge()),g.parentNode.removeChild(g),f({success:!0,data:e})}else f({success:!1})},i.src=e})}function h(){function a(a,b){var c,d=f?0:-8*(b-1),g=0;for(c=0;b>c;c++)g|=e.charCodeAt(a+c)<<Math.abs(d+8*c);return g}function b(a,b,c){var c=3===arguments.length?c:e.length-b-1;e=e.substr(0,b)+a+e.substr(c+b)}function c(a,c,d){var e,g="",h=f?0:-8*(d-1);for(e=0;d>e;e++)g+=String.fromCharCode(c>>Math.abs(h+8*e)&255);b(g,a,d)}var e,f=!1;return{II:function(a){return a===d?f:void(f=a)},init:function(a){f=!1,e=a},SEGMENT:function(a,c,d){switch(arguments.length){case 1:return e.substr(a,e.length-a-1);case 2:return e.substr(a,c);case 3:b(d,a,c);break;default:return e}},BYTE:function(b){return a(b,1)},SHORT:function(b){return a(b,2)},LONG:function(b,e){return e===d?a(b,4):void c(b,e,4)},SLONG:function(b){var c=a(b,4);return c>2147483647?c-4294967296:c},STRING:function(b,c){var d="";for(c+=b;c>b;b++)d+=String.fromCharCode(a(b,1));return d}}}function j(a){var b,c,e,f={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},g=[],i=d,k=0;if(b=new h,b.init(a),65496===b.SHORT(0)){for(c=2,e=Math.min(1048576,a.length);e>=c;)if(i=b.SHORT(c),i>=65488&&65495>=i)c+=2;else{if(65498===i||65497===i)break;k=b.SHORT(c+2)+2,f[i]&&b.STRING(c+4,f[i].signature.length)===f[i].signature&&g.push({hex:i,app:f[i].app.toUpperCase(),name:f[i].name.toUpperCase(),start:c,length:k,segment:b.SEGMENT(c,k)}),c+=k}return b.init(null),{headers:g,restore:function(a){b.init(a);var d=new j(a);if(!d.headers)return!1;for(var e=d.headers.length;e>0;e--){var f=d.headers[e-1];b.SEGMENT(f.start,f.length,"")}d.purge(),c=65504==b.SHORT(2)?4+b.SHORT(4):2;for(var e=0,h=g.length;h>e;e++)b.SEGMENT(c,0,g[e].segment),c+=g[e].length;return b.SEGMENT()},get:function(a){for(var b=[],c=0,d=g.length;d>c;c++)g[c].app===a.toUpperCase()&&b.push(g[c].segment);return b},set:function(a,b){var c=[];"string"==typeof b?c.push(b):c=b;for(var d=ii=0,e=g.length;e>d&&(g[d].app===a.toUpperCase()&&(g[d].segment=c[ii],g[d].length=c[ii].length,ii++),!(ii>=c.length));d++);},purge:function(){g=[],b.init(null)}}}}function k(){function a(a,b){var c,f,h,i,k,l,m,n,o=e.SHORT(a),p=[],q={};for(c=0;o>c;c++)if(m=l=a+12*c+2,h=b[e.SHORT(m)],h!==d){switch(i=e.SHORT(m+=2),k=e.LONG(m+=2),m+=4,p=[],i){case 1:case 7:for(k>4&&(m=e.LONG(m)+j.tiffHeader),f=0;k>f;f++)p[f]=e.BYTE(m+f);break;case 2:k>4&&(m=e.LONG(m)+j.tiffHeader),q[h]=e.STRING(m,k-1);continue;case 3:for(k>2&&(m=e.LONG(m)+j.tiffHeader),f=0;k>f;f++)p[f]=e.SHORT(m+2*f);break;case 4:for(k>1&&(m=e.LONG(m)+j.tiffHeader),f=0;k>f;f++)p[f]=e.LONG(m+4*f);break;case 5:for(m=e.LONG(m)+j.tiffHeader,f=0;k>f;f++)p[f]=e.LONG(m+4*f)/e.LONG(m+4*f+4);break;case 9:for(m=e.LONG(m)+j.tiffHeader,f=0;k>f;f++)p[f]=e.SLONG(m+4*f);break;case 10:for(m=e.LONG(m)+j.tiffHeader,f=0;k>f;f++)p[f]=e.SLONG(m+4*f)/e.SLONG(m+4*f+4);break;default:continue}n=1==k?p[0]:p,q[h]=g.hasOwnProperty(h)&&"object"!=typeof n?g[h][n]:n}return q}function b(){var b=d,c=j.tiffHeader;return e.II(18761==e.SHORT(c)),42!==e.SHORT(c+=2)?!1:(j.IFD0=j.tiffHeader+e.LONG(c+=2),b=a(j.IFD0,f.tiff),j.exifIFD="ExifIFDPointer"in b?j.tiffHeader+b.ExifIFDPointer:d,j.gpsIFD="GPSInfoIFDPointer"in b?j.tiffHeader+b.GPSInfoIFDPointer:d,!0)}function c(a,b,c){var d,g,h,k=0;if("string"==typeof b){var l=f[a.toLowerCase()];for(hex in l)if(l[hex]===b){b=hex;break}}for(d=j[a.toLowerCase()+"IFD"],g=e.SHORT(d),i=0;i<g;i++)if(h=d+12*i+2,e.SHORT(h)==b){k=h+8;break}return k?(e.LONG(k,c),!0):!1}var e,f,g,j={};return e=new h,f={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},g={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(a){return j={tiffHeader:10},a!==d&&a.length?(e.init(a),65505===e.SHORT(0)&&"EXIF\x00"===e.STRING(4,5).toUpperCase()?b():!1):!1},EXIF:function(){var b;return b=a(j.exifIFD,f.exif),b.ExifVersion&&(b.ExifVersion=String.fromCharCode(b.ExifVersion[0],b.ExifVersion[1],b.ExifVersion[2],b.ExifVersion[3])),b},GPS:function(){var b;return b=a(j.gpsIFD,f.gps),b.GPSVersionID&&(b.GPSVersionID=b.GPSVersionID.join(".")),b},setExif:function(a,b){return"PixelXDimension"!==a&&"PixelYDimension"!==a?!1:c("exif",a,b)},getBinary:function(){return e.SEGMENT()}}}var l,m={};c.runtimes.Html5=c.addRuntime("html5",{getFeatures:function(){var d,e,f,g,h,i;return e=f=h=i=!1,a.XMLHttpRequest&&(d=new XMLHttpRequest,f=!!d.upload,e=!(!d.sendAsBinary&&!d.upload)),e&&(g=!!(d.sendAsBinary||a.Uint8Array&&a.ArrayBuffer),h=!(!File||!File.prototype.getAsDataURL&&!a.FileReader||!g),i=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),l=!(c.ua.safari&&c.ua.windows),{html5:e,dragdrop:function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a}(),jpgresize:h,pngresize:h,multipart:h||!!a.FileReader||!!a.FormData,canSendBinary:g,cantSendBlobInFormData:!(!(c.ua.gecko&&a.FormData&&a.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:f,chunks:i,multi_selection:!(c.ua.safari&&c.ua.windows),triggerDialog:c.ua.gecko&&a.FormData||c.ua.webkit}},init:function(d,e){function h(a){var b,e,f,g=[],h={};for(e=0;e<a.length;e++)b=a[e],h[b.name]||(h[b.name]=!0,f=c.guid(),m[f]=b,g.push(new c.File(f,b.fileName||b.name,b.fileSize||b.size)));g.length&&d.trigger("FilesAdded",g)}var i;return i=this.getFeatures(),i.html5?(d.bind("Init",function(a){var e,f,g,i,j,k,l,m=[],n=a.settings.filters,o=b.body;e=b.createElement("div"),e.id=a.id+"_html5_container",c.extend(e.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0}),e.className="plupload html5",d.settings.container&&(o=b.getElementById(d.settings.container),"static"===c.getStyle(o,"position")&&(o.style.position="relative")),o.appendChild(e);a:for(g=0;g<n.length;g++)for(j=n[g].extensions.split(/,/),i=0;i<j.length;i++){if("*"===j[i]){m=[];break a}k=c.mimeTypes[j[i]],k&&m.push(k)}if(e.innerHTML='<input id="'+d.id+'_html5"  style="font-size:999px" type="file" accept="'+m.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />",e.scrollTop=100,l=b.getElementById(d.id+"_html5"),a.features.triggerDialog?c.extend(l.style,{position:"absolute",width:"100%",height:"100%"}):c.extend(l.style,{cssFloat:"right",styleFloat:"right"}),l.onchange=function(){h(this.files),this.value=""},f=b.getElementById(a.settings.browse_button)){var p=a.settings.browse_button_hover,q=a.settings.browse_button_active,r=a.features.triggerDialog?f:e;p&&(c.addEvent(r,"mouseover",function(){c.addClass(f,p)},a.id),c.addEvent(r,"mouseout",function(){c.removeClass(f,p)},a.id)),q&&(c.addEvent(r,"mousedown",function(){c.addClass(f,q)},a.id),c.addEvent(b.body,"mouseup",function(){c.removeClass(f,q)},a.id)),a.features.triggerDialog&&c.addEvent(f,"click",function(c){b.getElementById(a.id+"_html5").click(),c.preventDefault()},a.id)}}),d.bind("PostInit",function(){var a=b.getElementById(d.settings.drop_element);if(a){if(l)return void c.addEvent(a,"dragenter",function(){var e,f,g;e=b.getElementById(d.id+"_drop"),e||(e=b.createElement("input"),e.setAttribute("type","file"),e.setAttribute("id",d.id+"_drop"),e.setAttribute("multiple","multiple"),c.addEvent(e,"change",function(){h(this.files),c.removeEvent(e,"change",d.id),e.parentNode.removeChild(e)},d.id),a.appendChild(e)),f=c.getPos(a,b.getElementById(d.settings.container)),g=c.getSize(a),"static"===c.getStyle(a,"position")&&c.extend(a.style,{position:"relative"}),c.extend(e.style,{position:"absolute",display:"block",top:0,left:0,width:g.w+"px",height:g.h+"px",opacity:0})},d.id);c.addEvent(a,"dragover",function(a){a.preventDefault()},d.id),c.addEvent(a,"drop",function(a){console.log("drag over!");var b=a.dataTransfer;b&&b.files&&h(b.files),a.preventDefault()},d.id)}}),d.bind("Refresh",function(a){var e,f,g,h,i;e=b.getElementById(d.settings.browse_button),e&&(f=c.getPos(e,b.getElementById(a.settings.container)),g=c.getSize(e),h=b.getElementById(d.id+"_html5_container"),c.extend(h.style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"}),d.features.triggerDialog&&("static"===c.getStyle(e,"position")&&c.extend(e.style,{position:"relative"}),i=parseInt(c.getStyle(e,"z-index"),10),isNaN(i)&&(i=0),c.extend(e.style,{zIndex:i}),c.extend(h.style,{zIndex:i-1})))}),d.bind("UploadFile",function(b,d){function e(a,b,c){var d;if(!File.prototype.slice)return(d=File.prototype.webkitSlice||File.prototype.mozSlice)?d.call(a,b,c):null;try{return a.slice(),a.slice(b,c)}catch(e){return a.slice(b,c-b)}}function h(f){function g(){function m(e){var f,k=0,l=new XMLHttpRequest,m=l.upload,u="----pluploadboundary"+c.guid(),v="--",w="\r\n",x="";if(m&&(m.onprogress=function(a){d.loaded=Math.min(d.size,j+a.loaded-k),b.trigger("UploadProgress",d)}),l.onreadystatechange=function(){var a,i;if(4==l.readyState){try{a=l.status}catch(k){a=0}if(a>=400)b.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:d,status:a});else{if(o){if(i={chunk:h,chunks:o,response:l.responseText,status:a},b.trigger("ChunkUploaded",d,i),j+=r,i.cancelled)return void(d.status=c.FAILED);d.loaded=Math.min(d.size,(h+1)*q)}else d.loaded=d.size;b.trigger("UploadProgress",d),e=n=f=x=null,!o||++h>=o?(d.status=c.DONE,b.trigger("FileUploaded",d,{response:l.responseText,status:a})):g()}l=null}},b.settings.multipart&&i.multipart){if(p.name=d.target_name||d.name,l.open("post",t,!0),c.each(b.settings.headers,function(a,b){l.setRequestHeader(b,a)}),"string"!=typeof e&&a.FormData)return f=new FormData,c.each(c.extend(p,b.settings.multipart_params),function(a,b){f.append(b,a)}),f.append(b.settings.file_data_name,e),void l.send(f);if("string"==typeof e){if(l.setRequestHeader("Content-Type","multipart/form-data; boundary="+u),c.each(c.extend(p,b.settings.multipart_params),function(a,b){x+=v+u+w+'Content-Disposition: form-data; name="'+b+'"'+w+w,x+=unescape(encodeURIComponent(a))+w}),s=c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",x+=v+u+w+'Content-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(d.name))+'"'+w+"Content-Type: "+s+w+w+e+w+v+u+v+w,k=x.length-e.length,e=x,l.sendAsBinary)l.sendAsBinary(e);else if(i.canSendBinary){for(var y=new Uint8Array(e.length),z=0;z<e.length;z++)y[z]=255&e.charCodeAt(z);l.send(y.buffer)}return}}t=c.buildUrl(b.settings.url,c.extend(p,b.settings.multipart_params)),l.open("post",t,!0),l.setRequestHeader("Content-Type","application/octet-stream"),c.each(b.settings.headers,function(a,b){l.setRequestHeader(b,a)}),l.send(e)}var n,o,p,q,r,s,t=b.settings.url;d.status!=c.DONE&&d.status!=c.FAILED&&b.state!=c.STOPPED&&(p={name:d.target_name||d.name},k.chunk_size&&d.size>k.chunk_size&&(i.chunks||"string"==typeof f)?(q=k.chunk_size,o=Math.ceil(d.size/q),r=Math.min(q,d.size-h*q),n="string"==typeof f?f.substring(h*q,h*q+r):e(f,h*q,h*q+r),p.chunk=h,p.chunks=o):(r=d.size,n=f),"string"!=typeof n&&l&&i.cantSendBlobInFormData&&i.chunks&&b.settings.chunk_size?(l.onload=function(){m(l.result)},l.readAsBinaryString(n)):m(n))}var h=0,j=0,l="FileReader"in a?new FileReader:null;g()}var j,k=b.settings;j=m[d.id],i.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?g.call(b,d,b.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){a.success?(d.size=a.data.length,h(a.data)):h(j)}):!i.chunks&&i.jpgresize?f(j,h):h(j)}),d.bind("Destroy",function(a){var d,e,f=b.body,g={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(d in g)e=b.getElementById(g[d]),e&&c.removeAllEvents(e,a.id);c.removeAllEvents(b.body,a.id),a.settings.container&&(f=b.getElementById(a.settings.container)),f.removeChild(b.getElementById(g.inputContainer))}),void e({success:!0})):void e({success:!1})}})}(window,document,plupload);