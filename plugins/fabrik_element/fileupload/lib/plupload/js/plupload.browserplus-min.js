/*! Fabrik */
!function(a){a.runtimes.BrowserPlus=a.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(b,c){function d(c){var d,e,f,h=[];for(d=0;d<c.length;d++)e=c[d],f=a.guid(),g[f]=e,h.push(new a.File(f,e.name,e.size));d&&b.trigger("FilesAdded",h)}function e(){b.bind("PostInit",function(){function c(a,b){f.DragAndDrop.AddDropTarget({id:a},function(){f.DragAndDrop.AttachCallbacks({id:a,hover:function(a){!a&&b&&b()},drop:function(a){b&&b(),d(a)}},function(){})})}function e(){document.getElementById(j).style.top="-1000px"}var g,i=h.drop_element,j=b.id+"_droptarget",k=document.getElementById(i);k&&(document.attachEvent&&/MSIE/gi.test(navigator.userAgent)?(g=document.createElement("div"),g.setAttribute("id",j),a.extend(g.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0}),document.body.appendChild(g),a.addEvent(k,"dragenter",function(){var b,c;b=document.getElementById(i),c=a.getPos(b),a.extend(document.getElementById(j).style,{top:c.y+"px",left:c.x+"px",width:b.offsetWidth+"px",height:b.offsetHeight+"px"})}),c(j,e)):c(i)),a.addEvent(document.getElementById(h.browse_button),"click",function(b){var c,e,g,i=[],j=h.filters;b.preventDefault();a:for(c=0;c<j.length;c++)for(g=j[c].extensions.split(","),e=0;e<g.length;e++){if("*"===g[e]){i=[];break a}i.push(a.mimeTypes[g[e]])}f.FileBrowse.OpenBrowseDialog({mimeTypes:i},function(a){a.success&&d(a.value)})}),k=g=null}),b.bind("UploadFile",function(b,c){function d(e,g){var i;c.status!=a.FAILED&&(k.name=c.target_name||c.name,l&&(k.chunk=""+e,k.chunks=""+g),i=m.shift(),f.Uploader.upload({url:b.settings.url,files:{file:i},cookies:document.cookies,postvars:a.extend(k,b.settings.multipart_params),progressCallback:function(a){var d,f=0;for(h[e]=parseInt(a.filePercent*i.size/100,10),d=0;d<h.length;d++)f+=h[d];c.loaded=f,b.trigger("UploadProgress",c)}},function(f){var h;f.success?(h=f.value.statusCode,l&&b.trigger("ChunkUploaded",c,{chunk:e,chunks:g,response:f.value.body,status:h}),m.length>0?d(++e,g):(c.status=a.DONE,b.trigger("FileUploaded",c,{response:f.value.body,status:h}),h>=400&&b.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:c,status:h}))):b.trigger("Error",{code:a.GENERIC_ERROR,message:a.translate("Generic Error."),file:c,details:f.error})}))}function e(a){c.size=a.size,l?f.FileAccess.chunk({file:a,chunkSize:l},function(a){if(a.success){var b=a.value,c=b.length;h=Array(c);for(var e=0;c>e;e++)h[e]=0,m.push(b[e]);d(0,c)}}):(h=Array(1),m.push(a),d(0,1))}var h,j=g[c.id],k={},l=b.settings.chunk_size,m=[];i&&/\.(png|jpg|jpeg)$/i.test(c.name)?BrowserPlus.ImageAlter.transform({file:j,quality:i.quality||90,actions:[{scale:{maxwidth:i.width,maxheight:i.height}}]},function(a){a.success&&e(a.value.file)}):e(j)}),c({success:!0})}var f=window.BrowserPlus,g={},h=b.settings,i=h.resize;f?f.init(function(a){var b=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];i&&b.push({service:"ImageAlter",version:"4"}),a.success?f.require({services:b},function(a){a.success?e():c()}):c()}):c()}})}(plupload);