if(typeof akeeba=="undefined"){var akeeba={}}if(typeof akeeba.Dbfilters=="undefined"){akeeba.Dbfilters={currentRoot:null,loadingGif:""}}(function(a){akeeba.Dbfilters.activeRootChanged=function(){var b={root:a("#active_root").val()};akeeba.Dbfilters.load(b)};akeeba.Dbfilters.load=function(c){c.verb="list";var b={action:JSON.stringify(c)};akeeba.System.doAjax(b,function(d){akeeba.Dbfilters.render(d)},null,false,15000)};akeeba.Dbfilters.toggle=function(c,b,d){akeeba.Fsfilters.toggle(c,b,d)};akeeba.Dbfilters.render=function(c){akeeba.Dbfilters.currentRoot=c.root;var b=a("#tables");b.html("");a.each(c.tables,function(h,d){var f=a(document.createElement("div")).addClass("table-container");var i=["tables","tabledata"];a.each(i,function(j,k){var l=a(document.createElement("span")).addClass("table-icon-container btn btn-mini btn-default").attr("title",'<div class="tooltip-arrow-up-leftaligned"></div><div>'+Joomla.JText._("COM_AKEEBA_DBFILTER_TYPE_"+k.toUpperCase())+"</div>");switch(k){case"tables":l.append('<span class="ak-toggle-button icon icon-cancel"></span>');break;case"tabledata":l.append('<span class="ak-toggle-button icon icon-box-add"></span>');break}l.tooltip({placement:"bottom",delay:0});switch(d[k]){case 2:l.addClass("btn-danger").removeClass("btn-default");break;case 1:l.addClass("btn-warning").removeClass("btn-default");case 0:l.click(function(){var m={root:c.root,node:h,filter:k,verb:"toggle"};akeeba.Dbfilters.toggle(m,l)})}l.appendTo(f)});var g="icon-link";var e="COM_AKEEBA_DBFILTER_TABLE_MISC";switch(d.type){case"table":g="icon-list-2";e="COM_AKEEBA_DBFILTER_TABLE_TABLE";break;case"view":g="icon-copy";e="COM_AKEEBA_DBFILTER_TABLE_VIEW";break;case"procedure":g="icon-cube";e="COM_AKEEBA_DBFILTER_TABLE_PROCEDURE";break;case"function":g="icon-puzzle";e="COM_AKEEBA_DBFILTER_TABLE_FUNCTION";break;case"trigger":g="icon-flash";e="COM_AKEEBA_DBFILTER_TABLE_TRIGGER";break}a(document.createElement("span")).addClass("table-name").html(h).prepend(a(document.createElement("span")).addClass("table-icon-container table-icon-noclick table-icon-small").attr("title",Joomla.JText._(e)).append(a(document.createElement("span")).addClass("icon").addClass(g)).tooltip({placement:"bottom",delay:0})).prepend(a(document.createElement("span")).addClass("table-icon-container table-icon-noclick table-icon-small").append(a(document.createElement("span")).addClass("icon").addClass("icon-menu").css("color","#ccc"))).appendTo(f);f.appendTo(b)})};akeeba.Dbfilters.loadTab=function(c){var d={verb:"tab",root:c};var b={action:JSON.stringify(d)};akeeba.System.doAjax(b,function(e){akeeba.Dbfilters.renderTab(e)},null,false,15000)};akeeba.Dbfilters.addRow=function(d,c){var b=Joomla.JText._("COM_AKEEBA_DBFILTER_TYPE_"+d.type.toUpperCase());if(b==null){b=d.type}a(document.createElement("tr")).addClass("ak_filter_row").append(a(document.createElement("td")).addClass("ak_filter_type").append(b)).append(a(document.createElement("td")).addClass("ak_filter_item").append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container btn btn-mini btn-default").click(function(){if(d.node==""){a(this).parent().parent().remove();return}var e={root:a("#active_root").val(),node:d.node,filter:d.type,verb:"remove"};akeeba.Dbfilters.toggle(e,a(this),function(f,g){if(f.success){g.parent().parent().remove()}})}).append(a(document.createElement("span")).addClass("ak-toggle-button icon icon-trash deletebutton"))).append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container btn btn-mini btn-default").click(function(){if(a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing")){return}a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing",true);a(this).next().hide();a(document.createElement("input")).attr({type:"text",size:60}).val(a(this).next().html()).appendTo(a(this).parent()).blur(function(){var f=a(this).val();if(f==""){a(this).parent().children("span.ak_filter_name").show();a(this).siblings("span.ak_filter_tab_icon_container").find("span.deletebutton").click();a(this).remove();return}var e={root:a("#active_root").val(),old_node:d.node,new_node:f,filter:d.type,verb:"swap"};var g=a(this);akeeba.Dbfilters.toggle(e,g.siblings("span.ak_filter_tab_icon_container:first").next(),function(h,i){g.siblings("span.ak_filter_tab_icon_container:first").next().removeData("editing");g.parent().find("span.ak_filter_name").show();g.siblings("span.ak_filter_tab_icon_container:first").next().removeClass("btn-warning").addClass("btn-default");g.parent().find("span.ak_filter_name").html(f);g.remove();d.node=f})}).focus()}).append(a(document.createElement("span")).addClass("ak-toggle-button icon icon-pencil editbutton"))).append(a(document.createElement("span")).addClass("ak_filter_name").html(d.node))).appendTo(a(c))};akeeba.Dbfilters.addNew=function(c){var b={type:c,node:""};akeeba.Dbfilters.addRow(b,a("#ak_list_table"));a("#ak_list_table tr:last").children("td:last").children("span.ak_filter_tab_icon_container:last").click()};akeeba.Dbfilters.renderTab=function(c){var b=a("#ak_list_contents");b.html("");a.each(c,function(d,e){akeeba.Dbfilters.addRow(e,b)})};akeeba.Dbfilters.excludeNonCMS=function(){a("#tables div").each(function(c,b){var e=a(b).find("span.table-name:first").text();var f=e.substr(0,3);if(f!="#__"){var d=a(b).find("span.table-icon-container span.icon:first");if(!(a(d).parent().hasClass("btn-warning"))){a(d).click()}}})};akeeba.Dbfilters.nuke=function(){var c={root:akeeba.Dbfilters.currentRoot,verb:"reset"};var b={action:JSON.stringify(c)};akeeba.System.doAjax(b,function(d){akeeba.Dbfilters.render(d)},null,false,15000)}}(akeeba.jQuery));