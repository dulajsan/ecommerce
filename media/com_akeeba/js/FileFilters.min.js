if(typeof akeeba=="undefined"){var akeeba={}}if(typeof akeeba.Fsfilters=="undefined"){akeeba.Fsfilters={currentRoot:null,loadingGif:""}}(function(a){akeeba.Fsfilters.activeRootChanged=function(){var b={};b.root=a("#active_root").val();b.crumbs=[];b.node="";akeeba.Fsfilters.load(b)};akeeba.Fsfilters.load=function(d){d.verb="list";var c=JSON.stringify(d);var b={};b.action=c;akeeba.System.doAjax(b,function(e){akeeba.Fsfilters.render(e)},null,false,15000)};akeeba.Fsfilters.toggle=function(g,d,h,f){if(f==null){f=true}if(d!=null){if(d.data("loading")==true){return}d.data("loading",true);if(f){var c=d.children("span:first")}else{var c=d}d.data("icon",c.attr("class"));c.removeClass(d.data("icon"));c.addClass("icon");c.addClass("ak-toggle-button");c.addClass("ak-toggle-button-spinning");c.addClass("icon-star-empty");c.data("akeebatimer",setInterval(function(){if(c.hasClass("icon-star-empty")){c.removeClass("icon-star-empty");c.addClass("icon-star")}else{if(c.hasClass("icon-star")){c.removeClass("icon-star");c.addClass("icon-star-empty")}}},100))}var e=JSON.stringify(g);var b={action:e};akeeba.System.doAjax(b,function(i){if(d!=null){timer=c.data("akeebatimer");clearInterval(timer);c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}if(i.success==true){if(d!=null){if(f){if(i.newstate==true){d.removeClass("btn-default");d.addClass("btn-warning")}else{d.addClass("btn-default");d.removeClass("btn-warning")}}}if(!(h==null)){h(i,d)}}else{if(!(h==null)){h(i,d)}var j=a("#dialog");j.html("");a(document.createElement("p")).html(Joomla.JText._("COM_AKEEBA_FILEFILTERS_LABEL_UIERRORFILTER").replace("%s",g.node)).appendTo(j);j.dialog("open")}},function(i){if(d!=null){timer=c.data("akeebatimer");clearInterval(timer);c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}akeeba.System.params.errorCallback(i)},true,15000)};akeeba.Fsfilters.render=function(f){akeeba.Fsfilters.currentRoot=f.root;var j=[];var d=[Joomla.JText._("COM_AKEEBA_FILEFILTERS_LABEL_UIROOT"),f.root,[],""];j.push(d);if(f.crumbs.length>0){var h=[];a.each(f.crumbs,function(n,o){var p=[o,f.root,h.slice(0),o];j.push(p);h.push(o)})}var e=a("#ak_crumbs");e.html("");a.each(j,function(n,p){var o=a(document.createElement("li"));a(document.createElement("a")).attr("href","javascript:").html(p[0]).click(function(){a(this).append(a(document.createElement("img")).attr({src:akeeba.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"5px",marginLeft:"5px"}));var q={root:p[1],crumbs:p[2],node:p[3]};akeeba.Fsfilters.load(q)}).appendTo(o);a(document.createElement("span")).addClass("divider").text("/").appendTo(o);o.appendTo(e)});var k=a("#folders");k.html("");if(f.crumbs.length>0){var m=a(document.createElement("div")).addClass("folder-container");m.append(a(document.createElement("span")).addClass("folder-padding")).append(a(document.createElement("span")).addClass("folder-padding")).append(a(document.createElement("span")).addClass("folder-padding")).append(a(document.createElement("span")).addClass("folder-name folder-up").html("("+e.find("li:last").prev().find("a").html()+")").prepend(a(document.createElement("span")).addClass("icon icon-arrow-up")).click(function(){e.find("li:last").prev().find("a").click()})).appendTo(k)}if(Object.keys(f.folders).length>0){var c=["directories_all","skipdirs_all","skipfiles_all"];var i=a(document.createElement("div")).addClass("folder-header folder-container");a.each(c,function(n,o){var q=a(document.createElement("span")).addClass("folder-icon-container btn btn-mini btn-default").attr("title",'<div class="tooltip-arrow-up-leftaligned"></div><div>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_"+o.toUpperCase())+"</div>").tooltip({html:true,placement:"top"});var p="";switch(o){case"directories_all":p="icon-cancel";q.append('<span class="ak-toggle-button icon icon-cancel"></span>');break;case"skipdirs_all":p="icon-folder-open";q.append('<span class="ak-toggle-button icon icon-folder-open"></span>');break;case"skipfiles_all":p="icon-file";q.append('<span class="ak-toggle-button icon icon-file"></span>');break}q.click(function(){var r;if(a(this).hasClass("btn-warning")){a(this).removeClass("btn-warning").addClass("btn-default");r=false}else{a(this).addClass("btn-warning").removeClass("btn-default");r=true}a.each(k.find(".folder-container").not(".folder-header").find("span."+p),function(s,u){var t=a(u).parent().hasClass("btn-warning");if((!r&&!t)||(r&&t)){return}a(u).click()})});q.appendTo(i)});a(document.createElement("span")).addClass("folder-name").html('<span class="pull-left icon icon-downarrow"></span>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_APPLYTOALLDIRS")).appendTo(i);i.appendTo(k)}a.each(f.folders,function(o,p){var n=a(document.createElement("div")).addClass("folder-container");var q=["directories","skipdirs","skipfiles"];a.each(q,function(r,s){var t=a(document.createElement("span")).addClass("btn btn-mini btn-default folder-icon-container").attr("title",'<div class="tooltip-arrow-up-leftaligned"></div><div>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_"+s.toUpperCase())+"</div>");switch(s){case"directories":t.append('<span class="ak-toggle-button icon icon-cancel"></span>');break;case"skipdirs":t.append('<span class="ak-toggle-button icon icon-folder-open"></span>');break;case"skipfiles":t.append('<span class="ak-toggle-button icon icon-file"></span>');break}t.tooltip({placement:"bottom",delay:0});switch(p[s]){case 2:t.removeClass("btn-default");t.addClass("btn-danger");break;case 1:t.removeClass("btn-default");t.addClass("btn-warning");case 0:t.click(function(){var u={root:f.root,crumbs:h,node:o,filter:s,verb:"toggle"};akeeba.Fsfilters.toggle(u,t)})}t.appendTo(n)});a(document.createElement("span")).html(o).addClass("folder-name").click(function(){a(this).append(a(document.createElement("img")).attr({src:akeeba.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"3px",marginLeft:"5px"}));var r={root:f.root,crumbs:h,node:o};akeeba.Fsfilters.load(r)}).appendTo(n);n.appendTo(k)});var g=a("#files");g.html("");if(Object.keys(f.files).length>0){var l=a(document.createElement("div")).addClass("file-header file-container");var b=a(document.createElement("span")).addClass("file-icon-container btn btn-mini btn-default");b.append('<span class="ak-toggle-button icon icon-cancel"></span>');b.attr("title",'<div class="tooltip-arrow-up-leftaligned"></div><div>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_FILES_ALL")+"</div>").tooltip({html:true,placement:"top"});b.click(function(){var n;if(a(this).hasClass("btn-warning")){a(this).removeClass("btn-warning").addClass("btn-default");n=false}else{a(this).addClass("btn-warning").removeClass("btn-default");n=true}a.each(g.find(".file-container").not(".file-header").find("span.icon-cancel"),function(o,q){var p=a(q).parent().hasClass("btn-warning");if((!n&&!p)||(n&&p)){return}a(q).click()})});b.appendTo(l);a(document.createElement("span")).addClass("file-name").html('<span class="pull-left icon icon-downarrow"></span>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_APPLYTOALLFILES")).appendTo(l);l.appendTo(g)}a.each(f.files,function(o,p){var n=a(document.createElement("div")).addClass("file-container");var q=["files"];a.each(q,function(r,s){var t=a(document.createElement("span")).addClass("file-icon-container btn btn-mini btn-default");switch(s){case"files":t.append('<span class="ak-toggle-button icon icon-cancel"></span>');break}t.attr("title",'<div class="tooltip-arrow-up-leftaligned"></div><div>'+Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_"+s.toUpperCase())+"</div>").tooltip({html:true,placement:"top"});switch(p[s]){case 2:t.removeClass("btn-default");t.addClass("btn-danger");break;case 1:t.removeClass("btn-default");t.addClass("btn-warning");case 0:t.click(function(){var u={root:f.root,crumbs:h,node:o,filter:s,verb:"toggle"};akeeba.Fsfilters.toggle(u,t)})}t.appendTo(n)});n.append(a(document.createElement("span")).addClass("file-name").html(o)).append(a(document.createElement("span")).addClass("file-size").html(size_format(p.size)));n.appendTo(g)})};akeeba.Fsfilters.nuke=function(){var c={root:akeeba.Fsfilters.currentRoot,verb:"reset"};var b={action:JSON.stringify(c)};akeeba.System.doAjax(b,function(d){akeeba.Fsfilters.render(d)},null,false,15000)};akeeba.Fsfilters.loadTab=function(c){var d={verb:"tab",root:c};var b={action:JSON.stringify(d)};akeeba.System.doAjax(b,function(e){akeeba.Fsfilters.renderTab(e)},null,false,15000)};akeeba.Fsfilters.addRow=function(d,c){var b=Joomla.JText._("COM_AKEEBA_FILEFILTERS_TYPE_"+d.type.toUpperCase());if(b==null){b=d.type}a(document.createElement("tr")).addClass("ak_filter_row").append(a(document.createElement("td")).addClass("ak_filter_type").append(b)).append(a(document.createElement("td")).addClass("ak_filter_item").append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container btn btn-mini btn-default").click(function(){if(d.node==""){a(this).parent().parent().remove();return}var e={root:a("#active_root").val(),crumbs:[],node:d.node,filter:d.type,verb:"toggle"};akeeba.Fsfilters.toggle(e,a(this),function(f,g){if(f.success){g.parent().parent().remove()}})}).append(a(document.createElement("span")).addClass("ak-toggle-button icon icon-trash deletebutton"))).append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container btn btn-mini btn-default").click(function(){if(a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing")){return}a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing",true);a(this).next().hide();a(document.createElement("input")).attr({type:"text",size:60}).val(a(this).next().html()).appendTo(a(this).parent()).blur(function(){var f=a(this).val();if(f==""){a(this).parent().children("span.ak_filter_name").show();a(this).siblings("span.ak_filter_tab_icon_container").find("span.deletebutton").click();a(this).remove();return}var e={root:a("#active_root").val(),crumbs:[],old_node:d.node,new_node:f,filter:d.type,verb:"swap"};var g=a(this);akeeba.Fsfilters.toggle(e,g.siblings("span.ak_filter_tab_icon_container:first").next(),function(h,i){g.siblings("span.ak_filter_tab_icon_container:first").next().removeData("editing");g.parent().find("span.ak_filter_name").show();g.siblings("span.ak_filter_tab_icon_container:first").next().removeClass("btn-warning").addClass("btn-default");g.parent().find("span.ak_filter_name").html(f);g.remove();d.node=f})}).focus()}).append(a(document.createElement("span")).addClass("ak-toggle-button icon icon-pencil-2 editbutton"))).append(a(document.createElement("span")).addClass("ak_filter_name").html(d.node))).appendTo(a(c))};akeeba.Fsfilters.addNew=function(c){var b={type:c,node:""};akeeba.Fsfilters.addRow(b,a("#ak_list_table"));a("#ak_list_table tr:last").children("td:last").children("span.ak_filter_tab_icon_container:last").click()};akeeba.Fsfilters.renderTab=function(c){var b=a("#ak_list_contents");b.html("");a.each(c,function(d,e){akeeba.Fsfilters.addRow(e,b)})}}(akeeba.jQuery));