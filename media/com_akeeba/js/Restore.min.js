if(typeof akeeba=="undefined"){var akeeba={}}if(typeof akeeba.Restore=="undefined"){akeeba.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null,password:null,ajaxURL:null,mainURL:null}}(function(a){akeeba.Restore.errorCallbackDefault=function(b){a("#restoration-progress").hide();a("#restoration-error").show();a("#backup-error-message").html(b)};akeeba.Restore.doAjax=function(g,b,d){json=JSON.stringify(g);if(akeeba.Restore.password.length>0){json=AesCtr.encrypt(json,akeeba.Restore.password,128)}var h={json:json};var e=new Date().getTime()/1000;var f=parseInt(e,10);h._cacheBustingJunk=Math.round((e-f)*1000);var c={type:"POST",url:akeeba.Restore.ajaxURL,cache:false,data:h,timeout:600000,success:function(n){var m=null;var k="";var i=n.indexOf("###");if(i==-1){n="Invalid AJAX data: "+n;if(d==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(n)}else{akeeba.Restore.errorCallbackDefault(n)}}else{d(n)}return}else{if(i!=0){m=n.substr(0,i);k=n.substr(i)}else{k=n}}k=k.substr(3);i=k.lastIndexOf("###");k=k.substr(0,i);if(akeeba.Restore.password.length>0){k=AesCtr.decrypt(k,akeeba.Restore.password,128)}try{var l=JSON.parse(k)}catch(j){errorMessage=j.message+"\n<br/>\n<pre>\n"+k+"\n</pre>";if(d==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(errorMessage)}else{akeeba.Restore.errorCallbackDefault(errorMessage)}}else{d(errorMessage)}return}b(l)},error:function(i,m,k){var l=i.responseText?i.responseText:"";var j="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+i.status+" ("+i.statusText+")<br/>";j=j+"Internal status: "+m+"<br/>";j=j+"XHR ReadyState: "+i.readyState+"<br/>";j=j+"Raw server response:<br/>"+akeeba.System.sanitizeErrorMessage(l);if(d==null){if(akeeba.Restore.errorCallback!=null){akeeba.Restore.errorCallback(j)}else{akeeba.Restore.errorCallbackDefault(j)}}else{d(j)}}};a.ajax(c)};akeeba.Restore.startTimeoutBar=function(c,b){akeeba.Restore.resetTimeoutBar();akeeba.Restore.timer=setInterval(function(){akeeba.Restore.lastResponseSeconds++;var d=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",akeeba.Restore.lastResponseSeconds.toFixed(0));a("#response-timer div.text").html(d)},1000)};akeeba.Restore.resetTimeoutBar=function(){akeeba.Restore.lastResponseSeconds=0;if(akeeba.Restore.timer==0){return}clearInterval(akeeba.Restore.timer);akeeba.Restore.timer=0;var b=a("#response-timer div.text");var c=Joomla.JText._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");b.html(c)};akeeba.Restore.pingRestoration=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;var b={task:"ping"};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.start(c)})};akeeba.Restore.start=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;var b={task:"startRestore"};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.step(c)})};akeeba.Restore.step=function(b){akeeba.Restore.resetTimeoutBar();if(b.status==false){akeeba.Restore.errorCallbackDefault(b.message)}else{if(b.done){akeeba.Restore.factory=b.factory;a("#restoration-progress").hide();a("#restoration-extract-ok").show()}else{akeeba.Restore.statistics.inbytes+=b.bytesIn;akeeba.Restore.statistics.outbytes+=b.bytesOut;akeeba.Restore.statistics.files+=b.files;a("#extbytesin").html(akeeba.Restore.statistics.inbytes);a("#extbytesout").html(akeeba.Restore.statistics.outbytes);a("#extfiles").html(akeeba.Restore.statistics.files);post={task:"stepRestore",factory:b.factory};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(post,function(c){akeeba.Restore.step(c)})}}};akeeba.Restore.finalize=function(){var b={task:"finalizeRestore",factory:akeeba.Restore.factory};akeeba.Restore.startTimeoutBar(5000,80);akeeba.Restore.doAjax(b,function(c){akeeba.Restore.finished(c)})};akeeba.Restore.finished=function(){window.location=akeeba.Restore.mainURL};akeeba.Restore.runInstaller=function(){window.open("../installation/index.php","abiinstaller");(function(d){var b=d("#restoration-runinstaller");var c=d("#restoration-finalize");b.removeClass("btn-large btn-success").addClass("btn-inverse btn-small");c.show()})(akeeba.jQuery)};akeeba.Restore.restoreDefaultOptions=function(){var b=a("#jps_key");if(b.length){b.val("ChromeIsDumb");b.val("")}}}(akeeba.jQuery));